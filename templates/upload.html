<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏ä‰º†ÁÖßÁâá - AIÊô∫ËÉΩÁ©øÊê≠</title>
    <!-- ÂºïÂÖ•Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- ÂºïÂÖ•Ëá™ÂÆö‰πâCSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .form-select {
            background-position: right 0.75rem center;
        }
    </style>
</head>
<body>
    <!-- ÂØºËà™Ê†è -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">AIÊô∫ËÉΩÁ©øÊê≠</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="/">È¶ñÈ°µ</a></li>
                    <li class="nav-item"><a class="nav-link active" href="/upload">‰∏ä‰º†ÁÖßÁâá</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
    <div class="container mt-5">
        <div class="row">
            <!-- Â±Ö‰∏≠ÊòæÁ§∫ -->
            <div class="col-md-8 offset-md-2">
                <!-- È°µÈù¢Ê†áÈ¢ò -->
                <h2 class="text-center mb-4">‰∏ä‰º†ÊÇ®ÁöÑÁÖßÁâáËøõË°åÂàÜÊûê</h2>
                
                <!-- ‰∏ä‰º†Ë°®ÂçïÂç°Áâá -->
                <div class="card mb-4">
                    <div class="card-body">
                        <!-- Âú∞Âå∫ÈÄâÊã©‰∏éÂ§©Ê∞îÂ±ïÁ§∫ -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label class="form-label">ÈÄâÊã©ÂΩìÂâç‰ΩçÁΩÆ</label>
                                <div class="row g-2">
                                    <div class="col-4">
                                        <select class="form-select form-select-sm" id="provinceSelect">
                                            <option value="">ÁúÅ‰ªΩ</option>
                                        </select>
                                    </div>
                                    <div class="col-4">
                                        <select class="form-select form-select-sm" id="citySelect" disabled>
                                            <option value="">ÂüéÂ∏Ç</option>
                                        </select>
                                    </div>
                                    <div class="col-4">
                                        <select class="form-select form-select-sm" id="districtSelect" disabled>
                                            <option value="">Âå∫Âéø</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-text text-muted" id="locationStatus">ËØ∑ÈÄâÊã©ÂÆåÊï¥ÁöÑÁúÅÂ∏ÇÂå∫‰ø°ÊÅØ</div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ÂÆûÊó∂Â§©Ê∞î & Êó∂Èó¥</label>
                                <div class="card bg-light border-0">
                                    <div class="card-body py-2 d-flex justify-content-between align-items-center">
                                        <div id="weatherInfo" class="text-muted">
                                            <small>ËØ∑ÂÖàÈÄâÊã©ÂüéÂ∏Ç</small>
                                        </div>
                                        <div id="timeDisplay" class="fw-bold text-primary">--:--</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ‰∏ä‰º†Ë°®ÂçïÔºåidÁî®‰∫éJavaScriptÊìç‰Ωú -->
                        <form id="uploadForm">
                            <div class="mb-3">
                                <!-- Êñá‰ª∂ËæìÂÖ•Ê°ÜÔºå‰ªÖÊé•ÂèóÂõæÂÉèÁ±ªÂûã -->
                                <label for="imageInput" class="form-label">ÈÄâÊã©ÁÖßÁâá</label>
                                <input type="file" class="form-control" id="imageInput" accept="image/*" required>
                                <!-- Â∏ÆÂä©ÊñáÊú¨ -->
                                <div class="form-text">ÊîØÊåÅ JPG„ÄÅPNG„ÄÅGIF Ê†ºÂºèÔºåÊúÄÂ§ß 16MB</div>
                            </div>
                            
                            <!-- ÂõæÁâáÈ¢ÑËßàÂå∫ÂüüÔºåÈªòËÆ§ÈöêËóè -->
                            <div class="mb-3" id="previewContainer" style="display: none;">
                                <label class="form-label">È¢ÑËßà</label>
                                <!-- È¢ÑËßàÂõæÁâá -->
                                <img id="imagePreview" class="img-fluid rounded" style="max-height: 400px;">
                            </div>
                            
                            <!-- ‰∏ä‰º†ÊåâÈíÆ -->
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary" id="uploadBtn">
                                    <!-- Âä†ËΩΩÂä®ÁîªÔºåÈªòËÆ§ÈöêËóè -->
                                    <span class="spinner-border spinner-border-sm d-none" id="uploadSpinner"></span>
                                    <!-- ÊåâÈíÆÊñáÊú¨ -->
                                    <span id="uploadBtnText">‰∏ä‰º†Âπ∂ÂàÜÊûê</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- ËôöÊãüËØïÁ©øÂå∫Âüü (ÊõøÊç¢ÂéüÊâãÂä®‰∏ä‰º†Âå∫Âüü) -->
                <div id="virtualTryOnSection" class="mt-4" style="display: none;">
                    <div class="card border-primary shadow-sm">
                        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">üëó ËôöÊãüËØïÁ©ø</h5>
                            <small>Step 2</small>
                        </div>
                        <div class="card-body">
                            
                            <!-- 1. Á°ÆËÆ§Ê®°Áâπ‰ø°ÊÅØ -->
                            <div class="mb-4">
                                <h6 class="card-title text-muted mb-3">ÂΩìÂâçÊ®°Áâπ</h6>
                                <div class="d-flex align-items-center bg-light p-3 rounded">
                                    <div style="width: 80px; height: 80px; overflow: hidden;" class="rounded me-3 border">
                                        <img id="currentModelPreview" src="" alt="Model" style="width: 100%; height: 100%; object-fit: cover;">
                                    </div>
                                    <div>
                                        <div class="badge bg-success mb-1">Â∑≤Â∞±Áª™</div>
                                        <div class="small text-muted">Ê®°ÁâπÁÖßÁâáÂ∑≤Ëá™Âä®‰∏ä‰º†Ëá≥‰∫ëÁ´ØÔºåÂèØÈáçÂ§ç‰ΩøÁî®</div>
                                    </div>
                                </div>
                            </div>

                            <hr>

                            <!-- 2. ‰∏ä‰º†Ë°£Áâ© -->
                            <div class="mb-4">
                                <h6 class="card-title text-muted mb-3">ÈÄâÊã©Ë°£Áâ©</h6>
                                
                                <!-- ËØïÁ©øÊ®°ÂºèÈÄâÊã© -->
                                <div class="btn-group w-100 mb-3" role="group">
                                    <input type="radio" class="btn-check" name="tryonMode" id="modeTop" value="top" checked>
                                    <label class="btn btn-outline-primary" for="modeTop">‰ªÖ‰∏äË£Ö</label>

                                    <input type="radio" class="btn-check" name="tryonMode" id="modeBottom" value="bottom">
                                    <label class="btn btn-outline-primary" for="modeBottom">‰ªÖ‰∏ãË£Ö</label>

                                    <input type="radio" class="btn-check" name="tryonMode" id="modeFull" value="full">
                                    <label class="btn btn-outline-primary" for="modeFull">ÂÖ®Ë∫´ (‰∏ä‰∏ãË£Ö)</label>
                                </div>

                                <div class="row g-3">
                                    <!-- ‰∏äË£Ö‰∏ä‰º† -->
                                    <div class="col-md-12" id="topUploadContainer">
                                        <label class="form-label small">‰∏ä‰º†‰∏äË£ÖÂõæÁâá (Ëá™Âä®‰∏ä‰º†Ëá≥OSS)</label>
                                        <div class="input-group">
                                            <input type="file" class="form-control" id="topGarmentInput" accept="image/*">
                                        </div>
                                        <div class="mt-2" id="topGarmentStatus" style="display: none;"></div>
                                    </div>
                                    
                                    <!-- ‰∏ãË£Ö‰∏ä‰º† -->
                                    <div class="col-md-12" id="bottomUploadContainer" style="display: none;">
                                        <label class="form-label small">‰∏ä‰º†‰∏ãË£ÖÂõæÁâá (Ëá™Âä®‰∏ä‰º†Ëá≥OSS)</label>
                                        <div class="input-group">
                                            <input type="file" class="form-control" id="bottomGarmentInput" accept="image/*">
                                        </div>
                                        <div class="mt-2" id="bottomGarmentStatus" style="display: none;"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- 3. ÂºÄÂßãËØïÁ©ø -->
                            <div class="d-grid">
                                <button class="btn btn-primary btn-lg" id="startAutoTryOnBtn" disabled>
                                    ‚ú® ÂºÄÂßãÁîüÊàêËØïÁ©øÊïàÊûú
                                </button>
                            </div>
                            
                        </div>
                    </div>
                </div>

                <!-- ËôöÊãüËØïÁ©øÁªìÊûúÔºåÈªòËÆ§ÈöêËóè -->
                <div id="tryonResult" class="mt-4" style="display: none;">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">‚ú® ËØïÁ©øÊàêÂäü</h5>
                        </div>
                        <div class="card-body text-center">
                            <div id="tryonStatus" class="alert alert-info" style="display: none;"></div>
                            <div id="tryonImageContainer" style="display: none;">
                                <img id="tryonImage" class="img-fluid rounded shadow mb-3" style="max-height: 500px;">
                                <div>
                                    <button class="btn btn-success" onclick="window.open(document.getElementById('tryonImage').src)">
                                        <i class="fa fa-download"></i> Êü•ÁúãÂ§ßÂõæ
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÈöêËóèÁöÑ URL Â≠òÂÇ®Â≠óÊÆµ -->
                <input type="hidden" id="modelOssUrl">
                <input type="hidden" id="topOssUrl">
                <input type="hidden" id="bottomOssUrl">

                <!-- ‰øùÁïôÂéüÊúâÁöÑÂàÜÊûêÁªìÊûúÂå∫Âüü -->
                <div id="analysisResult" class="mt-4" style="display: none;">

                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">ÂàÜÊûêÁªìÊûú</h5>
                        </div>
                        <!-- ÂàÜÊûêÁªìÊûúÂÜÖÂÆπÔºåÈÄöËøáJavaScriptÂä®ÊÄÅÂ°´ÂÖÖ -->
                        <div class="card-body" id="analysisContent">
                        </div>
                    </div>
                </div>

                <!-- ÈöêËóè‰∏çÈúÄË¶ÅÁöÑÊóßÂå∫ÂüüÔºå‰ΩÜ‰øùÁïôDOM‰ª•ÂÖçÊä•Èîô -->
                <div style="display: none;">
                    <!-- OSS‰∏ä‰º†Â∑•ÂÖ∑Ê®°Âùó -->
                    <div class="card mt-4 mb-4 border-info" id="oldOssTool">
                        <!-- ... -->
                    </div>
                    <!-- ÊâãÂä®‰∏ä‰º†Ë°£Áâ©Âå∫Âüü -->
                    <div id="manualGarmentUpload"></div>
                </div>


            </div>
        </div>
    </div>

    <!-- ÂºïÂÖ•Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- ÂºïÂÖ•Ëá™ÂÆö‰πâJavaScript -->
    <script src="{{ url_for('static', filename='js/upload.js') }}"></script>
</body>
</html>